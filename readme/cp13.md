# Chapter13

## 学び
マイクロポストのcontentの型はstringではなく、textを使用（stringは255文字まで格納可能だが、フォームにテキストエリアを使用、言語に応じて投稿の長さを調節可能な点からcontentを採用）  

```
@micropost = Micropost.new(content: "Lorem ipsum", user_id: @user.id)
```
これを
```
@micropost = @user.microposts.build(content: "Lorem ipsum")
```
こうすることで慣習的に正しい方法となるようにユーザーとの関連付けを経由してマイクロポストを作成できる（新規のマイクロポストがこの方法で作成される場合、user_idは自動的に正しい値に設定される）  

モデルだけでなく、fixtureも関連付けが可能
```
orange:
  content: "I just ate an orange!"
  created_at: <%= 10.minutes.ago %>
  user: michael
```
こうすると
```
michael:
  name: Michael Example
  email: michael@example.com
  .
  .
```
このfixtureを参照できる  

* fixtureファイル内では`created_at`などのマジックカラムを手動で更新可能（created_atカラムの値を明示的に設定しない場合、テストが不安定になったり、システムに依存する可能性があるので得策ではない)  

* `default_scope`メソッドを使うとデータベースから要素を取得するときに、デフォルトの順序を指定できる(下の例は作成が新しい順で取得)  
```
default_scope -> { order(created_at: :desc) }
```
 * user.rbで`has_many :microposts, dependent: :destroy`と記述するとユーザーが削除されると同時に投稿も削除されるようになる（持ち主の存在しないマイクロポストがデータベースに取り残されてしまう問題を防ぐ）  
 