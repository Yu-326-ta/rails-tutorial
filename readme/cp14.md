# Chapter14

## 学び
* 複合キーインデックスで、follower_idとfollowed_idの組み合わせが重複しないよう保証（同じユーザーが２回以上フォローできないようにするため）  

Userモデルにfollowingの関連付けを行う（relationshipsテーブルからfollowed_idを用いてコレクションを取得することをRailsに明示的に伝える）  
```
has_many :following, through: :active_relationships, source: :followed
```

* Userモデルに関連付けを行うことで
```
user.following.include?(other_user)
user.following.find(other_user)
user.following << other_user
user.following.delete(other_user)
```
などが使えるようになる（<<は配列の末尾に要素を追加）  

* 以下の関連付けを行うことでrelationshipsテーブルをactive_relationshipsとして扱っている  
```
has_many :active_relationships, class_name:  "Relationship",
                                  foreign_key: "follower_id",
                                  dependent:   :destroy
```

route.rbで以下のようにルーティングを行うと、`/users/1/following`や`/users/1/followers`のようにユーザーidを含むURLを扱えるようになる  
```
resources :users do
  collection do
    get :tigers
  end
end
```

* @userがnilではないプロフィールページの場合は何もせず、nilになるHomeページの場合には@userにcurrent_userを代入  
```
<% @user ||= current_user %>
```
